---
title: First-Mile Test
description: This is documentation that covers how to use the capability tool for first-mile farmed and wild capability test.
---

# Registration
Official registration for the capaibilty tool is not open yet, we are still in beta mode.

# Capability Process
The capability process is an automated process that can be executed by a solution provider to determine if a specific version of a traceability solution is GDST Capable.

## Before we get started...
Before we get started make sure that you have registered for the GDST Capability Tool by following the registration steps above. After that you will need:

* the URL to the Capability Tool API
* your API Key for accessing the Capability Tool API
* the exact name of the traceability solution provided during registration
* the version number of the traceability solution you will be accessing

### Variables
During this documentation you will encounter many variables that will be wrapped in curly-braces like so "{CAPABILITY_TOOL-API-URL}". 

Below is a list of these variables and what they mean:

* {CAPABILITY_TOOL-API-URL} - the base url to the capability tool
* {YOUR-SOLUTION-NAME} - the name of your registered solution
* {YOUR-API-KEY} - this is the api key generaed by the capability tool and given to you to access the capability process api, digital link resolver, and epcis query interface of the capability tool.
* {CAPABILITY-TOOL-API-KEY} - this is the api key that the capability tool will use to access your digital link resolver and epcis query interface.
* {VERSION-OF-YOUR-SOLUTION} - the version of the traceability solution you are testing
* {CAPABILITY-TOOL-GENERATED-EPC} - one or more epcs for product instances generated by the capability tool
* {SOLUTION-PROVIDER-GENERATED-EPC} - one or more epcs for product instances generated by the solution provider
* {CAPABILITY-PROCESS-UUID} - the UUID of the capability process generated and returned to you when you start the capability process
* {SOLUTION-PROVIDER-URL} - This is the GS1 Resolver URL provided to the Capability Tool by the solution provider.
* {SOLUTION-PROVIDER-EPCIS-URL} - This is the EPCIS URL.

## Step 1: Starting the Process
In order to start the process you will perform the following HTTP Request:

```
HTTP Post 1.1
{CAPABILITY_TOOL-API-URL}/process/start

Accept          application/json
Content-Type    application/json
X-API-Key       {YOUR-API-KEY}

{
    "SolutionName" : "{YOUR-SOLUTION-NAME}",
    "Version" : "{VERSION-OF-YOUR-SOLUTION}"
    "EPCs" : [ "{SOLUTION-PROVIDER-GENERATED-EPC}" ]
}
```

This HTTP Request will return the following response:

```
Content-Type    application/json
{
    "SolutionName" : "{YOUR-SOLUTION-NAME}",
    "Version" : "{VERSION-OF-YOUR-SOLUTION}",
    "UUID" : "{CAPABILITY-PROCESS-UUID}"
}
```

## Step 2: Capability Tool Requests Solution Generated Data using B2B Workflow
When you started the capability process, you provided one or more EPCs represented in this documentation as {SOLUTION-PROVIDER-GENERATED-EPC}. In this step, the Capability Tool is going to query your GS1 Resolver / EPCIS Query Interface to pull back traceability data related to this EPC(s).

### Querying the Digital Link Resolver of the Capability Tool to Obtain the EPCIS URL
In order to perform this step the capability tool will execute the following HTTP Request:

```
HTTP GET 1.1
{SOLUTION-PROVIDER-URL}/sscc/{SOLUTION-PROVIDER-GENERATED-EPC}?linkType=gs1:epcis

Accept                      application/json
X-API-Key                   {YOUR-API-KEY}
```

This HTTP Request will return the following response:

```
[
    {
        "linkType" : "gs1:epcis",
        "link" : "{SOLUTION-PROVIDER-EPCIS-URL}",
        "authRequired" : true,
    }
]
```

### Querying the the EPCIS Query Interface for all events associated with the EPC
In order to perform this step, the capability tool will execute the following HTTP Request:

```
HTTP POST 1.1
{SOLUTION-PROVIDER-EPCIS-URL}/queries/SimpleEventQuery

Accept                      application/xml
X-API-Key                   {YOUR-API-KEY}

{
    "type" : "events",
    "query" : {
        "MATCH_anyEPC" : [ 
            "{SOLUTION-PROVIDER-GENERATED-EPC}"
        ]
    }
}
```

***HTTP Response***
```
Content-Type	        application/xml
GS1-EPCIS-Version	    1.2
GS1-EPCIS-Min	        1.2
GS1-EPCIS-Max	        1.2
GS1-CBV-Version	        1.2
GS1-EPC-Version	        ALWAYS_EPC_URN
GS1-CBV-XML-Format	    ALWAYS_URN

<epcis:EPCISDocument xmlns:epcis="urn:epcglobal:epcis:xsd:1"
                     xmlns:cbvmda="urn:epcglobal:cbv:mda" 
                     xmlns:gdst="https://traceability-dialogue.org/epcis" 
                     xmlns:sbdh="http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader" 
                     schemaVersion="1.2" 
                     creationDate="2022-01-01T00:00:00.000Z">
    <EPCISHeader>
        <sbdh:StandardBusinessDocumentHeader>    
            <!-- Standard Business Document Header -->
        </sbdh:StandardBusinessDocumentHeader>
        <extension>
            <EPCISMasterData>
                <VocabularyList>
                    <Vocabulary type="urn:epcglobal:epcis:vtype:EPCClass">
                        <!-- Trade Items / Product Definitions -->
                    </Vocabulary>
                    <Vocabulary type="urn:epcglobal:epcis:vtype:Location">
                        <!-- Locations -->
                    </Vocabulary>
                    <Vocabulary type="urn:epcglobal:epcis:vtype:Party">
                        <!-- Trading Parties -->
                    </Vocabulary>
                </VocabularyList>
            </EPCISMasterData>
        </extension>
    </EPCISHeader>
    <EPCISBody>
        <EventList>
            <!-- EPCIS Events -->
        </EventList>
    </EPCISBody>
</epcis:EPCISDocument>
```

> This example assumes the {SOLUTION-PROVIDER-GENERATED-EPC} is an instance-level EPC, if it was a class-level EPC, then you would use the MATCH_anyEPCClass filter instead.

> The Capability Tool will also perform a trace-back. This is covered in our Communication Protocol / Trace-back article.

## Step 3: Capability Tool Requests Solution Generated Data using Internal System-to-System
At this point the Capability Tool is going to use the same communication protocols from step 2 to request the same data back from you. 

> NOTE: This step will use the GE_recordTime and LE_recordTime. It will scan the events returned in step 2 to find the min/max record time. 

### Querying the Digital Link Resolver of the Capability Tool to Obtain the EPCIS URL
In order to perform this step the capability tool will execute the following HTTP Request:

```
HTTP GET 1.1
{SOLUTION-PROVIDER-URL}/digitallink/sscc/{CAPABILITY-TOOL-GENERATED-EPC}?linkType=gs1:epcis

Accept          application/json
X-API-Key       {CAPABILITY-TOOL-API-KEY}
```

This HTTP Request will return the following response:

```
[
    {
        "linkType" : "gs1:epcis",
        "link" : "{SOLUTION-PROVIDER-EPCIS-URL}",
        "authRequired" : true,
    }
]
```

### Querying the the EPCIS Query Interface for all events associated with the EPC
In order to perform this step, the capability tool will execute the following HTTP Request:

```
HTTP POST 1.1
{SOLUTION-PROVIDER-EPCIS-URL}/SimpleEventQuery

Accept          application/xml
X-API-Key       {CAPABILITY-TOOL-API-KEY}

{
    "type" : "events",
    "query" : {
        "GE_recordTime" : {START_OF_CAPABILITY_PROCESS},
        "LE_recordTime" : {CURRENT_UTC_DATETIME}
    }
}
```

*HTTP Response*
```
Content-Type	        application/xml
GS1-EPCIS-Version	    1.2
GS1-EPCIS-Min	        1.2
GS1-EPCIS-Max	        1.2
GS1-CBV-Version	        1.2
GS1-EPC-Version	        ALWAYS_EPC_URN
GS1-CBV-XML-Format	    ALWAYS_URN

<epcis:EPCISDocument xmlns:epcis="urn:epcglobal:epcis:xsd:1"
                     xmlns:cbvmda="urn:epcglobal:cbv:mda" 
                     xmlns:gdst="https://traceability-dialogue.org/epcis" 
                     xmlns:sbdh="http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader" 
                     schemaVersion="1.2" 
                     creationDate="2022-01-01T00:00:00.000Z">
    <EPCISHeader>
        <sbdh:StandardBusinessDocumentHeader>    
            <!-- Standard Business Document Header -->
        </sbdh:StandardBusinessDocumentHeader>
        <extension>
            <EPCISMasterData>
                <VocabularyList>
                    <Vocabulary type="urn:epcglobal:epcis:vtype:EPCClass">
                        <!-- Trade Items / Product Definitions -->
                    </Vocabulary>
                    <Vocabulary type="urn:epcglobal:epcis:vtype:Location">
                        <!-- Locations -->
                    </Vocabulary>
                    <Vocabulary type="urn:epcglobal:epcis:vtype:Party">
                        <!-- Trading Parties -->
                    </Vocabulary>
                </VocabularyList>
            </EPCISMasterData>
        </extension>
    </EPCISHeader>
    <EPCISBody>
        <EventList>
            <!-- EPCIS Events -->
        </EventList>
    </EPCISBody>
</epcis:EPCISDocument>
```

> No trace-back is required here.

# Step 4: Request the Report
At any point during the capability process you can request a report about the capability process. You can use this method to poll for the status until steps 4 and 5 are complete.

Once completed, you can see if you passed or fail and a list of errors about what failed, if anything.

```
HTTP Get 1.1
{CAPABILITY_TOOL-API-URL}/process/report

Accept                      application/json
Content-Type                application/json
X-API-Key                   {YOUR-API-KEY}
```

This would respond with: 

```
{
    "solutionName" : "Test Solution",
    "complianceProcessUUID" : "9ed4c7e6-a37c-4597-b650-c0cf73d58b82",
    "status" : 0,
    "stage" : 3,
    "errors" : []
}
```

> For the this call you need to make sure to include the ***X-Capability-Process-UUID*** header in the request call including the UUID for the capability process you started.

Stage: 
* 0 = unknown
* 1 = full-chain stage #1
* 2 = full-chain stage #2
* 3 = first mile stage #1
* 4 = finished

Status:
* 0 = started
* 10 = failed - indicates you completed the capability process with errors
* 11 = passed - indicates you completed the capability process with no errors
* 12 = approved - a gdst team member as reviewed your passed capability process and approved it
* 13 = timed out - automatically set to this if not passed or failed within 2 hours

## Understanding the Errors
Potential when you get the report, it might contain errors. The report also provides a text formatted copy of the report for human reading. It also contains an array of each error.

Using the error report, you can have errors from three categories:

* Found an error when checking the capability process generated data for CTE/KDE completeness errors. This is the data that the capability tool generated, you requested from the capability tool, and then the capability tool then requested back from you.

* Found an error when checking the capabilty process generated data for equality errors. The data that was generated by the capability tool, requested by you, and then requested back by the capability tool needs to be the same as the original generated data.

* Found an error when checking the data you generated for CTE/KDE completeness errors.

The human-readable version might look something like this:

```
** Traceability Solution Generated Data Errors - CTE/KDE Completeness Check **

    - none of the product definitions have a product form set, at least one shave have the product form set

    --- Landing Event

        EVENT ID: 42f45aae-6bba-4e94-95f7-c0f27726a46e
            - requires a certificate with type set to 'urn:gdst:certType:humanPolicy'

    --- Processing Event

        EVENT ID: 9553669b-2942-42a2-8c10-400968fd056a
            - has no expiration date set on the ILMD
            - has no country of origin set or the value was invalid

        EVENT ID: 442a7cab-cf87-4269-8a65-8913f9431316
            - has no expiration date set on the ILMD
            - has no country of origin set or the value was invalid

    --- Aggregate Event
            * Failed to find event with type Aggregation, action ADD, and business step urn:epcglobal:cbv:bizstep:packing
```

